CMAKE_MINIMUM_REQUIRED(VERSION 2.8)
PROJECT(Crypto++ CXX)

FILE(GLOB CryptoPP_HEADERS "${CMAKE_CURRENT_SOURCE_DIR}/*.h")
FILE(GLOB CryptoPP_SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/*.cpp")

IF(APPLE OR ${CMAKE_SYSTEM_NAME} MATCHES "FreeBSD")
  ADD_DEFINITIONS("-DCRYPTOPP_DISABLE_ASM")
ENDIF()

ADD_LIBRARY("crypto++" SHARED ${CryptoPP_SOURCES})
IF(APPLE AND "${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU")
  SET_TARGET_PROPERTIES("crypto++" PROPERTIES COMPILE_FLAGS "-O2 -fPIC -Wa,-q")
ELSE()
  SET_TARGET_PROPERTIES("crypto++" PROPERTIES COMPILE_FLAGS "-O2 -fPIC")
ENDIF()
INSTALL(TARGETS "crypto++"
        LIBRARY DESTINATION "lib"
        ARCHIVE DESTINATION "lib")

INSTALL(FILES ${CryptoPP_HEADERS}
        DESTINATION "include/crypto++")

INSTALL(CODE "EXECUTE_PROCESS(COMMAND \"${CMAKE_COMMAND}\" -E create_symlink \"${CMAKE_INSTALL_PREFIX}/include/crypto++\" \"${CMAKE_INSTALL_PREFIX}/include/cryptopp\")")
INSTALL(CODE "EXECUTE_PROCESS(COMMAND \"${CMAKE_COMMAND}\" -E create_symlink \"${CMAKE_INSTALL_PREFIX}/lib/libcrypto++.so\" \"${CMAKE_INSTALL_PREFIX}/lib/libcryptopp.so\")")
